<!-- HTML header for doxygen 1.13.2-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RoboCapture: RoboCapture</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
<script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">RoboCapture<span id="projectnumber">&#160;0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('index.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">RoboCapture </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__2home_2rcd_2proj_2skola_2robocapture_2README"></a></p>
<h1><a class="anchor" id="autotoc_md1"></a>
What?</h1>
<p>RoboCapture is a wrapper around a number of popular audio/video processing modules that allows you to define and deploy multisensor processing pipelines.</p>
<p><a href="https://lbesson.mit-license.org/"><img src="https://img.shields.io/badge/License-MIT-blue.svg" alt="MIT license" style="pointer-events: none;" class="inline"/></a> <img src="https://badgen.net/badge/Python/3.12.5" alt="pyver" class="inline"/> <img src="https://badgen.net/badge/docker/yes/green" alt="docker" class="inline"/></p>
<hr  />
<h1><a class="anchor" id="autotoc_md2"></a>
Installation</h1>
<p>The recommended way to run RoboCapture is to use the docker method. If you wish to run robocapture locally you can do so by following the local installation method described below, however YMMV.</p>
<h2><a class="anchor" id="autotoc_md3"></a>
Get to the source.</h2>
<p>Clone this repo to a suitable place in your filesystem:</p>
<p><code>git clone <a href="https://github.com/fgrhlm/robocapture.git">https://github.com/fgrhlm/robocapture.git</a></code></p>
<hr  />
<h2><a class="anchor" id="install-gpu"></a>
GPU Acceleration</h2>
<p>Some of the included workers make use of 3rd party libraries that supports accelerated processing by using GPU resources. To leverage this functionality in your pipelines you need to have a supported GPU and the necessary software installed. RoboCapture is developed and tested on an extremely limited number of hardware configurations. At the moment, compatibility testing is only being done on nvidia platforms.</p>
<h3><a class="anchor" id="autotoc_md4"></a>
Nvidia</h3>
<p>If your systems package repository includes <code>cuDNN == 9.3</code> and <code>cuda == 12.5</code>, go ahead and use your package manager to install those. If not then you can install them manually:</p>
<h4><a class="anchor" id="autotoc_md5"></a>
cuDNN</h4>
<p>Download the <a href="https://developer.nvidia.com/cudnn-9-3-0-download-archive">binaries</a>. Install using <a href="https://developer.nvidia.com/cudnn-9-3-0-download-archive">instructions</a>.</p>
<h3><a class="anchor" id="autotoc_md6"></a>
cuda</h3>
<p>Download the <a href="https://developer.nvidia.com/cuda-12-5-0-download-archive">binaries</a>. Install using <a href="https://docs.nvidia.com/cuda/archive/12.5.0/cuda-installation-guide-linux/index.html">instructions</a>.</p>
<h4><a class="anchor" id="autotoc_md7"></a>
Nvidia Container Toolkit (Needed for docker gpu passthrough)</h4>
<p>Follow installation instructions <a href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html">here</a></p>
<hr  />
<h2><a class="anchor" id="install-linux"></a>
Linux</h2>
<h3><a class="anchor" id="autotoc_md8"></a>
Python</h3>
<p>RoboCapture expects python version <code>3.12.5</code>. If your distro does not provide a package for this specific version (it probably does not) you can use one of the following methods to obtain the correct version:</p>
<h4><a class="anchor" id="autotoc_md9"></a>
Using pyenv (recommended)</h4>
<p>Install pyenv following the instructions <a href="https://github.com/pyenv/pyenv?tab=readme-ov-file#a-getting-pyenv">here</a></p>
<ol type="1">
<li>Navigate to source directory <code>cd robocapture/</code></li>
<li>Get python 3.12.9 <code>pyenv install 3.12.9</code></li>
<li>Robocapture ships with a <code>.python-version</code> file which should allow pyenv to automatically switch to the correct python version when in the source directory. You can test that your environment is using the correct py version by (while in source directory) running <code>python --version</code> and verifying that the output reads <code>Python 3.12.9</code></li>
</ol>
<h4><a class="anchor" id="autotoc_md10"></a>
Manual Installation</h4>
<p>Follow official instructions <a href="https://www.python.org/downloads/release/python-3129/">here</a></p>
<h4><a class="anchor" id="autotoc_md11"></a>
Building from source</h4>
<p>Follow official instructions <a href="https://docs.python.org/3.12/using/unix.html#building-python">here</a></p>
<h4><a class="anchor" id="autotoc_md12"></a>
Create and activate virtualenv</h4>
<p><code>python -m venv venv &amp;&amp; source venv/bin/activate</code></p>
<h4><a class="anchor" id="autotoc_md13"></a>
Install python dependencies</h4>
<p><code>pip install -r requirements.txt</code></p>
<hr  />
<h2><a class="anchor" id="install-docker"></a>
Docker</h2>
<p>Install and configure docker follow these <a href="https://www.docker.com/get-started/">instructions</a></p>
<p>If you intend to run GPU accelerated workers make sure you've looked at <a class="el" href="#install-gpu">Docs / Installation / GPU Acceleration</a>.</p>
<ol type="1">
<li>Build the image: <code>docker compose build</code></li>
</ol>
<hr  />
<h2><a class="anchor" id="autotoc_md14"></a>
Robot Operating System (ROS)</h2>
<p><b>WIP</b></p>
<hr  />
<h1><a class="anchor" id="autotoc_md15"></a>
Configuration</h1>
<h2><a class="anchor" id="autotoc_md16"></a>
General</h2>
<div class="fragment"><div class="line">server_type    | The base worker. Can be &quot;audio&quot; or &quot;video&quot;.</div>
<div class="line">device         | Base worker input device.</div>
</div><!-- fragment --><p>_See <a class="el" href="#config-workers">Docs / Config / External Workers</a></p>
<div class="fragment"><div class="line">on_data        | List of workers to be called when base worker has new data.</div>
<div class="line">on_save        | List of workers to be called when base worker writes to the filesystem.</div>
<div class="line">on_trigger_in  | List of workers to be called when base worker &quot;trigger&quot; is set.</div>
<div class="line">on_trigger_out | List of workers to be called when base worker &quot;trigger&quot; is unset.</div>
</div><!-- fragment --><p><em>See <a class="el" href="#config-socket">Docs / Config / Socket</a></em></p>
<div class="fragment"><div class="line">socket         | WebSocket config.</div>
</div><!-- fragment --><p><em>See <a class="el" href="#config-logging">Docs / Config / Logging</a></em></p>
<div class="fragment"><div class="line">log            | Log config.</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md17"></a>
Audio</h2>
<p><em>See <a href="https://python-sounddevice.readthedocs.io/en/0.5.1/api/raw-streams.html#sounddevice.RawInputStream">python-sounddevice.readthedocs.io</a></em></p>
<div class="fragment"><div class="line">sample_rate    | Stream sample rate.</div>
<div class="line">channels       | Stream channels.</div>
<div class="line">blksize        | Stream block size.</div>
<div class="line"> </div>
<div class="line">mode           | The capture mode. Can be &quot;voice_activity&quot; or &quot;normal&quot;.</div>
<div class="line">rec_threshold  | (Only in &quot;activity&quot; mode) The input-level at which capturing is triggered.</div>
<div class="line">rec_hold       | (Only in &quot;activity&quot; mode) How long the capture should continue after activity stops.</div>
<div class="line">max_clip_len   | Maximum clip length (in seconds).</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md18"></a>
Video</h2>
<div class="fragment"><div class="line">img_w          | Output frame width.</div>
<div class="line">img_h          | Output frame height.</div>
<div class="line">img_color      | Output frame color mode.</div>
</div><!-- fragment --><h2><a class="anchor" id="config-workers"></a>
External Worker</h2>
<div class="fragment"><div class="line">enabled        | On/Off.</div>
<div class="line">name           | Name of the worker.</div>
<div class="line">path           | Path to the worker .py source file.</div>
<div class="line">config         | Config to pass into worker.</div>
</div><!-- fragment --><h2><a class="anchor" id="config-socket"></a>
Socket</h2>
<div class="fragment"><div class="line">host           | Hostname.</div>
<div class="line">port           | Port.</div>
</div><!-- fragment --><h2><a class="anchor" id="config-logging"></a>
Logging</h2>
<div class="fragment"><div class="line">logLevel       | Log verbosity.</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md19"></a>
YOLO</h2>
<p>Options in this section are explained further <a href="https://docs.ultralytics.com/modes/predict/#inference-arguments">here</a>.</p>
<div class="fragment"><div class="line">model_format   | Model format. Can be &quot;onnx&quot;, &quot;openvino&quot;, &quot;tensor_rt&quot; or &quot;tflite&quot;</div>
<div class="line">weights        | Model weights.</div>
<div class="line">min_conf       | Minimum detection confidence.</div>
<div class="line">img_size       | Input Image Size.</div>
<div class="line">stream         | Enables optimized processing of long videos or large batches.</div>
<div class="line">verbose        | Enables debugging output during inference.</div>
<div class="line">half           | Enables FP16 inference.</div>
<div class="line">max_detect     | Max. amount of detections per image.</div>
<div class="line">vid_stride     | Skip `n` amount of frames.</div>
<div class="line">export_config  | Config for export formats.</div>
</div><!-- fragment --><p>For more information on <code>export_config</code> options look <a href="https://docs.ultralytics.com/modes/export/#export-formats">here</a></p>
<p>Example:</p>
<div class="fragment"><div class="line">export_config = {</div>
<div class="line">    &quot;onnx&quot;: { &quot;simplify&quot;: true, &quot;half&quot;: true, &quot;nms&quot;: true},</div>
<div class="line">    &quot;openvino&quot;: { &quot;half&quot;: false, &quot;nms&quot;: true, &quot;int8&quot;: true, &quot;data&quot;: &quot;coco8.yaml&quot;},</div>
<div class="line">    &quot;tensor_rt&quot;: { &quot;simplify&quot;: true, &quot;half&quot;: false, &quot;nms&quot;: true, &quot;int8&quot;: true, &quot;data&quot;: &quot;coco8.yaml&quot;},</div>
<div class="line">    &quot;tflite&quot;: { &quot;half&quot;: false, &quot;nms&quot;: true, &quot;int8&quot;: true, &quot;data&quot;: &quot;coco8.yaml&quot;}</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md20"></a>
Yunet</h2>
<p>Options in this section are explained further <a href="https://docs.opencv.org/4.x/df/d20/classcv_1_1FaceDetectorYN.html">here</a></p>
<div class="fragment"><div class="line">img_size       | Input Image Size.</div>
<div class="line">weights        | Model weights.</div>
<div class="line">cpu            | Force cpu inference.</div>
<div class="line">img_size       | Input Image Size.</div>
<div class="line">min_detect     | Minimum detection confidence.</div>
<div class="line">max_nms        | Suppress bounding bouxes of IoU &gt; than `n`</div>
<div class="line">top_k          | Keep top K bounding boxes before NMS.</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md21"></a>
Whisper</h2>
<div class="fragment"><div class="line">weights        | Model Weights.</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md22"></a>
Running</h1>
<h2><a class="anchor" id="autotoc_md23"></a>
Linux</h2>
<p>First make sure you've followed all necessary steps in <a class="el" href="#install-linux">Docs / Installation / Linux</a> and then:</p>
<ol type="1">
<li>Activate venv: <code>source venv/bin/activate</code></li>
<li>Run: <code>python run_server &lt;path-to-config&gt;</code></li>
</ol>
<h2><a class="anchor" id="autotoc_md24"></a>
Docker</h2>
<p>Make sure you've followed all necessary steps in <a class="el" href="#install-docker">Docs / Installation / Docker</a> and then:</p>
<ol type="1">
<li>Inside repo root: <code>docker compose up</code></li>
</ol>
<h2><a class="anchor" id="autotoc_md25"></a>
ROS</h2>
<p>Make sure you've followed all necessary steps in Docs / Installation / ROS and then:</p>
<h1><a class="anchor" id="autotoc_md26"></a>
Usage</h1>
<p>Pipeline results can be accessed in the ways listed below. Please refer to individual workers documentation for details on output formatting for that specific worker. Reference clients and demos are included in <code>client/{python,js}/demos</code>.</p>
<h2><a class="anchor" id="autotoc_md27"></a>
WebSocket</h2>
<p>Python:</p>
<div class="fragment"><div class="line"><span class="keyword">from</span> asyncio <span class="keyword">import</span> run</div>
<div class="line"><span class="keyword">from</span> websockets.asyncio.client <span class="keyword">import</span> connect</div>
<div class="line"> </div>
<div class="line">rc_host = <span class="stringliteral">&quot;127.0.0.1&quot;</span></div>
<div class="line">rc_port = 9002</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Connect to websocket.</span></div>
<div class="line"><span class="keyword">async def </span>client():</div>
<div class="line">    <span class="keyword">async</span> <span class="keyword">with</span> connect(f<span class="stringliteral">&quot;ws://{rc_host}:{rc_port}&quot;</span>) <span class="keyword">as</span> socket:</div>
<div class="line">        <span class="keywordflow">while</span> <span class="keyword">True</span>:</div>
<div class="line">            <span class="comment"># Do something with the data</span></div>
<div class="line">            msg = await websocket.recv()</div>
<div class="line">            print(msg)</div>
<div class="line"> </div>
<div class="line">run(client())</div>
</div><!-- fragment --><p>Javascript (Not using robocapture.js):</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keyword">host</span> = <span class="stringliteral">&quot;127.0.0.1&quot;</span>; // <span class="keyword">RoboCapture</span> <span class="keyword">Server</span> <span class="keyword">Hostname</span></div>
<div class="line"><span class="keyword">const</span> <span class="keyword">port</span> = 9002;        // <span class="keyword">RoboCapture</span> <span class="keyword">Server</span> <span class="keyword">Port</span></div>
<div class="line"> </div>
<div class="line">// <span class="keyword">Connect</span> <span class="keyword">to</span> <span class="keyword">RoboCapture</span> <span class="keyword">Server.</span></div>
<div class="line"><span class="keyword">const</span> <span class="keyword">socket</span> = <span class="keyword">new</span> <span class="keyword">WebSocket</span>(`<span class="keyword">ws:</span>//${<span class="keyword">host</span>}:${<span class="keyword">port</span>}`);</div>
<div class="line"> </div>
<div class="line">// <span class="keyword">Do</span> <span class="keyword">something</span> <span class="keyword">with</span> <span class="keyword">the</span> <span class="keyword">data.</span></div>
<div class="line"><span class="keyword">socket.addEventListener</span>(<span class="stringliteral">&quot;message&quot;</span>, <span class="keyword">e</span> =&gt; {</div>
<div class="line">    <span class="keyword">console.log</span>(<span class="keyword">e</span>);</div>
<div class="line">});</div>
</div><!-- fragment --><p>Javascript (Using robocapture.js):</p>
<div class="fragment"><div class="line"><span class="keyword">import</span> { <span class="keyword">Client</span>, <span class="keyword">Hooks</span>, <span class="keyword">Callback</span> } <span class="keyword">from</span> <span class="stringliteral">&quot;/js/robocapture.js&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keyword">host</span> = <span class="stringliteral">&quot;127.0.0.1&quot;</span>; // <span class="keyword">RoboCapture</span> <span class="keyword">Server</span> <span class="keyword">Hostname</span></div>
<div class="line"><span class="keyword">const</span> <span class="keyword">port</span> = 9002;        // <span class="keyword">RoboCapture</span> <span class="keyword">Server</span> <span class="keyword">Port</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keyword">printMessage</span> = (<span class="keyword">e</span>) =&gt; {</div>
<div class="line">    <span class="keyword">console.log</span>(<span class="keyword">JSON.parse</span>(<span class="keyword">e.data</span>));</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keyword">audioClient</span> = <span class="keyword">new</span> <span class="keyword">Client</span>(<span class="stringliteral">&quot;localhost&quot;</span>, 9001, <span class="keyword">Array</span>(</div>
<div class="line">    <span class="keyword">new</span> <span class="keyword">Callback</span>(<span class="keyword">Hooks.MESSAGE</span>, <span class="keyword">printMessage</span>)</div>
<div class="line">));</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md28"></a>
ROS</h2>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"></a>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
